# IPBlockerTools

Набор инструментов для анализа лог-файлов и блокировки подозрительных IP-адресов на основе их активности.
Включает в себя вывод whois и данных из ABUSEIPDB. Скрипт анализирует лог nginx за последние n секунд и выводит список адресов для блокировки в iptables.

## Содержание

1. `state_ip.py` - скрипт для анализа лог-файлов и получения списка IP-адресов с количеством дублей.
2. `block_ips.sh` - скрипт для блокировки IP-адресов из списка, сгенерированного `state_ip.py`, с использованием `iptables`.

## Зависимости

- Python 3
- iptables
- whois
- jq

## Использование

- Установите недостающие зависимости. `sudo apt install whois jq -y`
- Склонируйте репозиторий
- Переименуйте `sample.env` и `sample.config.json` в `.env` и `config.json` соответственно.
- Внесите в файле .env данные о API KEY ABUSEIPDB (опционально).



"time_interval_seconds": 10:
Этот параметр задаёт временной интервал в секундах, в течение которого скрипт анализирует логи. В данном случае, значение равно 10, так что скрипт будет анализировать логи за последние 10 секунд. Любые записи в логах, которые старше этого времени, будут проигнорированы.

"output_threshold_count": 3:
Этот параметр определяет пороговое значение для количества вхождений IP-адреса в логах. Если какой-либо IP-адрес встречается в логах чаще, чем указанное количество раз (в данном случае 3), он будет включен в вывод скрипта. Это может использоваться для фильтрации IP-адресов, которые встречаются лишь несколько раз, и фокусировки внимания на тех, которые встречаются чаще.


### state_ip.py

Скрипт анализирует лог-файлы веб-сервера и генерирует список IP-адресов с количеством дублей на основе заданного временного интервала.

Запустите скрипт:

```bash
python state_ip.py
```

Скрипт сгенерирует файл blocked_ips.txt, содержащий список IP-адресов и количество дублей. После этого будет автоматически запущен скрипт block_ips.sh

### block_ips.sh

Скрипт читает список IP-адресов из файла blocked_ips.txt, сгенерированного скриптом state_ip.py, и блокирует их с использованием iptables выводя перед этим whois по ип адресу и данные из ABUSEIPDB. Перед блокировкой каждого ип скрипт запросит подтверждение.

Запустите скрипт:

```./block_ips.sh```

Скрипт запросит подтверждение на блокировку каждого IP-адреса из списка. Выберите `y` для блокировки или `n` для пропуска.

![image](https://user-images.githubusercontent.com/1340282/230800418-c799a2cd-25ce-4747-8e4c-ba04619d194d.png)
